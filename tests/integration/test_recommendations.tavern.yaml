---
test_name: Test Get Recommendations

marks:
  - skip: "This test is skipped because it fail"

stages:
  - name: Signup user for recommendations test
    request:
      url: "{tavern.env_vars.TEST_FRONTEND_URL}/auth/signup"
      method: POST
      json:
        email: "test{tavern.env_vars.TEST_TIMESTAMP}_recommendations@test.com"
        password: "password123"
        age: 35
        gender: "Male"
    response:
      status_code: 201

  - name: Login to get token
    request:
      url: "{tavern.env_vars.TEST_FRONTEND_URL}/auth/login"
      method: POST
      json:
        email: "test{tavern.env_vars.TEST_TIMESTAMP}_recommendations@test.com"
        password: "password123"
    response:
      status_code: 200
      save:
        json:
          token: "token"
          user_id: "user.user_id"

  - name: Test Get Recommendations
    request:
      url: "{tavern.env_vars.TEST_FRONTEND_URL}/recommendations/{user_id}"
      method: GET
      headers:
        Authorization: "Bearer {token}"
    response:
      status_code: 200
      headers:
        content-type: application/json
      verify_response_with:
        function: tests_helpers:validate_product_list
        extra_kwargs:
          required_fields:
            - item_id
            - product_name
            - category
            - about_product
            - img_link
            - discount_percentage
            - discounted_price
            - actual_price
            - product_link
            - rating_count
            - rating
